---
import { Plus, ArrowUpRight } from "@lucide/astro";

const faqs = [
  {
    id: "01",
    q: "¿DÓNDE ESTÁN UBICADOS SUS SERVIDORES?",
    a: "Contamos con infraestructura estratégica en dos puntos clave: Santiago de los Caballeros (República Dominicana) para latencia cero en el Caribe, y Allentown (EE.UU.) para conectividad global."
  },
  {
    id: "02",
    q: "¿PUEDO CAMBIAR DE PLAN SI MI SERVIDOR CRECE?",
    a: "Totalmente. Puedes subir de 4GB a 8GB con un solo click desde el panel. Solo pagas la diferencia y no pierdes ni un solo bloque de tu mundo."
  },
  {
    id: "03",
    q: "¿QUÉ JUEGOS SOPORTAN ADEMÁS DE MINECRAFT?",
    a: "Nuestro sistema automático despliega Minecraft, pero bajo ticket podemos configurar servidores de Project Zomboid, Rust, Ark y más. Si tienes el juego, nosotros tenemos el espacio."
  },
  {
    id: "04",
    q: "¿REALMENTE ME AYUDAN CON LA MIGRACIÓN?",
    a: "Sí. Si ya tienes un servidor en otro hosting, nuestro equipo se encarga de mover tus archivos, mundos y plugins a ArkaniaHost de forma gratuita. No queremos que empieces de cero."
  },
  {
    id: "05",
    q: "¿QUÉ MÉTODOS DE PAGO ACEPTAN?",
    a: "Procesamos pagos seguros mediante PayPal y Stripe. Esto te permite pagar con Tarjetas de Crédito/Débito, Apple Pay y Google Pay de forma inmediata y protegida."
  }
];
---

<section id="faq" class="py-24 relative bg-background border-b border-white/5">
  <div class="absolute inset-0 bg-grid-pattern opacity-5 pointer-events-none"></div>

  <div class="max-w-7xl mx-auto px-6 relative z-10">
    
    <div class="mb-16 flex flex-col md:flex-row items-end justify-between gap-8 border-b border-white/10 pb-8">
      <div>
        <h2 class="text-2xl md:text-4xl font-black text-white uppercase tracking-tighter">
          PREGUNTAS <span class="text-transparent bg-clip-text bg-linear-to-r from-brand-cyan to-brand-magenta">FRECUENTES</span>
        </h2>
        <p class="mt-4 text-slate-400 text-base font-light max-w-xl">
          Todo lo que necesitas saber antes de desplegar tu servidor.
        </p>
      </div>

      <a href="/soporte" class="group flex items-center gap-3 px-4 py-2 rounded bg-white/5 border border-white/10 hover:border-brand-cyan/50 transition-all duration-300">
         <div class="text-right">
            <span class="block text-[10px] font-mono font-bold text-slate-500 uppercase tracking-widest group-hover:text-brand-cyan transition-colors">¿Más dudas?</span>
            <span class="block text-sm font-bold text-white">Ir a Soporte</span>
         </div>
         <ArrowUpRight size={18} class="text-slate-500 group-hover:text-brand-cyan group-hover:-translate-y-0.5 group-hover:translate-x-0.5 transition-transform" />
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
      {faqs.map((faq) => (
        <div class="faq-item group relative bg-surface border border-white/5 rounded-xl overflow-hidden transition-all duration-300 hover:border-white/10">
          
          <div class="active-glow absolute inset-0 bg-linear-to-r from-brand-cyan/5 to-brand-magenta/5 opacity-0 transition-opacity duration-500 pointer-events-none"></div>

          <button 
            class="faq-button w-full py-6 px-6 flex items-start gap-5 text-left focus:outline-none relative z-10" 
            aria-expanded="false"
          >
            <span class="text-xl font-mono font-black text-white/10 group-hover:text-brand-cyan/50 transition-colors duration-300 select-none pt-0.5">
                {faq.id}
            </span>

            <span class="flex-1 text-sm md:text-base font-bold text-slate-300 group-hover:text-white transition-colors uppercase tracking-tight">
              {faq.q}
            </span>
            
            <div class="p-1.5 rounded-lg bg-white/5 text-slate-400 group-hover:text-white transition-colors duration-300 shrink-0">
                <Plus size={18} class="faq-icon transition-transform duration-300 ease-out" />
            </div>
          </button>
          
          <div class="faq-answer grid grid-rows-[0fr] transition-all duration-500 ease-out relative z-10">
            <div class="overflow-hidden">
                <div class="px-6 pb-8 pl-14"> 
                    <p class="text-slate-400 font-light text-sm leading-relaxed border-l-2 border-brand-magenta pl-4">
                        {faq.a}
                    </p>
                </div>
            </div>
          </div>

        </div>
      ))}
    </div>

  </div>
</section>

<script is:inline defer>
  const faqItems = document.querySelectorAll(".faq-item");

  faqItems.forEach((item) => {
    const button = item.querySelector(".faq-button");
    const answer = item.querySelector(".faq-answer");
    const icon = item.querySelector(".faq-icon");
    const glow = item.querySelector(".active-glow");
    const number = item.querySelector(".font-mono"); 

    // 1. CLÁUSULA DE GUARDIA:
    // Si falta algún elemento esencial, detenemos la ejecución aquí para este item.
    // Esto elimina el error de "button is possibly null" más abajo.
    if (!button || !answer || !icon || !glow || !number) return;

    button.addEventListener("click", () => {
      const isExpanded = button.getAttribute("aria-expanded") === "true";

      // 1. Cerrar otros
      faqItems.forEach((otherItem) => {
        if (otherItem !== item) {
          const otherBtn = otherItem.querySelector(".faq-button");
          const otherAns = otherItem.querySelector(".faq-answer");
          const otherIcon = otherItem.querySelector(".faq-icon");
          const otherGlow = otherItem.querySelector(".active-glow");
          const otherNum = otherItem.querySelector(".font-mono");
          
          // Usamos '?.' para que si algo de esto es null, simplemente lo ignore
          otherBtn?.setAttribute("aria-expanded", "false");
          otherAns?.classList.remove("grid-rows-[1fr]");
          otherAns?.classList.add("grid-rows-[0fr]");
          otherIcon?.classList.remove("rotate-45", "text-brand-magenta");
          otherGlow?.classList.remove("opacity-100");
          otherItem?.classList.remove("border-brand-magenta/30");
          otherNum?.classList.remove("text-brand-magenta");
        }
      });

      // 2. Toggle del actual (Aquí ya sabemos que existen por la guardia del inicio)
      if (!isExpanded) {
        button.setAttribute("aria-expanded", "true");
        answer.classList.remove("grid-rows-[0fr]");
        answer.classList.add("grid-rows-[1fr]");
        
        icon.classList.add("rotate-45", "text-brand-magenta");
        glow.classList.add("opacity-100");
        item.classList.add("border-brand-magenta/30");
        number.classList.add("text-brand-magenta"); 
      } else {
        button.setAttribute("aria-expanded", "false");
        answer.classList.remove("grid-rows-[1fr]");
        answer.classList.add("grid-rows-[0fr]");
        
        icon.classList.remove("rotate-45", "text-brand-magenta");
        glow.classList.remove("opacity-100");
        item.classList.remove("border-brand-magenta/30");
        number.classList.remove("text-brand-magenta");
      }
    });
  });
</script>